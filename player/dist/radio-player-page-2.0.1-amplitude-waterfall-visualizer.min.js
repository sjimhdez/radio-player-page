const u={COLUMN_WIDTH:2,SCROLL_SPEED:1,WAVEFORM_COLOR:"rgba(255, 255, 255, 0.3)",SMOOTHING_FACTOR:.3},C=new WeakMap;function r(o,c,l,t){o.width=c,o.height=l;const e=Math.ceil(c/u.COLUMN_WIDTH),s=new Array(e).fill(0),n=new Array(e).fill(0);return{canvasWidth:c,canvasHeight:l,dataPoints:t,columns:s,smoothedColumns:n}}function O(o){let c=0;for(let t=0;t<o.length;t++){const e=Math.abs(o[t]-128);c+=e}const l=c/o.length;return Math.min(255,l/128*255)}function d(o,c,l,t,e){const n=c/255*e/2,m=e/2-n,a=n*2;o.fillStyle=u.WAVEFORM_COLOR,o.fillRect(l,m,t,a)}function L(o,c){const l=o.columns.length;for(let n=0;n<l-u.SCROLL_SPEED;n++)o.columns[n]=o.columns[n+u.SCROLL_SPEED],o.smoothedColumns[n]=o.smoothedColumns[n+u.SCROLL_SPEED];const t=O(c),e=o.smoothedColumns[l-u.SCROLL_SPEED]||t,s=e+(t-e)*u.SMOOTHING_FACTOR;for(let n=0;n<u.SCROLL_SPEED;n++){const i=l-u.SCROLL_SPEED+n;i<l&&(o.columns[i]=t,o.smoothedColumns[i]=s)}}const S=(o,c,l,t,e)=>{let s=C.get(l);const n=c.length;(!s||s.canvasWidth!==t||s.canvasHeight!==e||s.dataPoints!==n)&&(s=r(l,t,e,n),C.set(l,s)),L(s,c),o.clearRect(0,0,t,e);const i=s.columns.length;for(let m=0;m<i;m++){const a=m*u.COLUMN_WIDTH;a<t&&d(o,s.smoothedColumns[m],a,u.COLUMN_WIDTH,e)}};export{S as amplitudeWaterfallVisualizer};
